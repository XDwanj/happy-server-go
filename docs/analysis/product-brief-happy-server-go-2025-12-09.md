---
stepsCompleted: [1, 2, 3, 4, 5]
inputDocuments:
  - 'docs/analysis/research/technical-happy-server-go-rewrite-research-2025-12-09.md'
workflowType: 'product-brief'
lastStep: 5
project_name: 'happy-server-go'
user_name: 'XDwanj'
date: '2025-12-09'
---

# Product Brief: happy-server-go

**日期：** 2025-12-09
**作者：** XDwanj

---

## 执行摘要

Happy Server Go 是 Happy Server 的轻量级替代版本，专为资源受限环境下的自部署场景设计。通过 Go 单体架构重写，它将原本需要多个外部依赖（PostgreSQL、Redis、MinIO）的部署简化为单个二进制文件或单容器部署，总内存占用从 300MB+ 外部依赖降低至 500MB 以内，使得小团队和个人开发者能够在 1-2GB RAM 的 VPS 上轻松运行完整的端到端加密同步服务。

Happy Server Go 保持与原版 100% 的 API 兼容性和功能一致性，确保现有客户端无需任何修改即可切换。作为并行维护的自部署友好版本，它为那些希望自建基础设施但资源有限的用户提供了理想选择，同时保持了 Happy Server 核心的零知识架构和隐私优先原则。

---

## 核心愿景

### 问题陈述

Claude Code 的多设备端到端加密同步需要可靠的后端服务支持。虽然 Happy Server 提供了托管服务选项，但许多小团队和个人开发者出于隐私、合规或成本考虑，更倾向于自部署解决方案。

然而，当前 Happy Server (Node.js) 的自部署门槛较高：
- **复杂的依赖管理**：需要配置和维护 PostgreSQL、Redis、MinIO 三个独立服务
- **较高的资源占用**：Node.js 运行时 + 三个外部服务的总内存占用对 1-2GB VPS 来说负担过重
- **部署复杂度**：多组件协调配置，增加部署失败风险和维护成本

这导致许多潜在的自部署用户望而却步，要么放弃自建选择托管服务，要么寻找其他替代方案。

### 问题影响

**对自部署用户的影响：**
- **小团队/小公司内部部署受阻**：典型的 1-2GB RAM VPS 无法稳定运行完整的 Happy Server 技术栈
- **部署门槛过高**：需要熟悉 PostgreSQL、Redis、MinIO 的配置和运维
- **运维负担重**：多组件意味着更多潜在故障点和维护工作
- **成本增加**：需要更高配置的服务器或更多服务器实例

**市场机会损失：**
对于那些最需要自部署（出于隐私、合规或特殊网络环境）的用户群体，当前的部署复杂度成为主要障碍，限制了 Happy Server 在这一细分市场的采用。

### 现有解决方案的不足

**当前 Happy Server (Node.js)：**
- ✅ 功能完整，架构成熟
- ✅ 托管服务体验优秀
- ❌ 自部署需要多个外部依赖
- ❌ 资源占用对低配环境不友好
- ❌ 部署和维护复杂度较高

**托管服务选项：**
虽然 Happy Server 提供免费托管服务（happy-api.slopus.com），且安全模型确保端到端加密，但部分用户仍有自部署需求：
- 企业合规要求数据必须在内部网络
- 特殊网络环境（内网、专网）无法访问公网服务
- 完全控制基础设施的诉求

市场上缺少一个既保持 Happy Server 完整功能，又能在资源受限环境下轻松部署的解决方案。

### 提议的解决方案

**Happy Server Go** 通过 Go 单体架构重写，将所有外部依赖内化：

**技术实现：**
- **内置缓存和 Pub/Sub**：使用 BigCache + 自实现事件总线替代 Redis
- **嵌入式数据库**：使用 SQLite 替代 PostgreSQL
- **内置文件存储**：本地文件系统存储替代 MinIO
- **Go 高性能运行时**：更低的内存占用和更高的并发性能

**部署体验：**
- **单二进制文件**：`./happy-server-go` 即可启动
- **单 Docker 容器**：零配置，一条命令完成部署
- **总内存 < 500MB**：适配 1-2GB VPS 环境
- **100% API 兼容**：现有客户端无需修改

**保持核心价值：**
- 🔐 零知识架构不变
- ⚡ 实时 WebSocket 同步
- 📱 多设备无缝切换
- 🔔 加密推送通知
- 🕵️ 隐私优先原则

### 核心差异化优势

**1. 零依赖部署**
- 无需配置 PostgreSQL、Redis、MinIO
- 从"需要运维多个服务"到"下载即运行"
- 降低部署失败率和运维复杂度

**2. 资源友好**
- 总内存占用 < 500MB（vs Node.js 300MB + 外部依赖）
- 适配 1GB VPS 环境
- 降低自部署成本

**3. 完全兼容**
- API 接口 100% 一致
- 功能特性完全对齐
- 现有客户端零改动切换

**4. 快速部署**
- 单二进制文件部署：下载 → 运行
- Docker 单容器部署：一条命令完成
- 从"需要 30 分钟配置多个服务"到"5 分钟完成部署"

**5. 保持开源透明**
- 继承 Happy Server 的开源精神
- MIT 协议，可审计、可修改
- 社区驱动的自部署友好版本

---

## 目标用户

### 主要用户

**小团队技术负责人 / 全栈开发者**

这个用户群体通常是 2-10 人规模的小团队或小公司中负责技术决策和基础设施管理的角色。他们需要为团队部署 Claude Code 的同步服务，但面临以下约束：

**环境特征：**
- 预算有限的 VPS 环境（1-2GB RAM）
- 需要自建基础设施（出于隐私、合规或成本考虑）
- 有基本的 Docker 和命令行操作能力

**核心需求：**
- **快速部署**：不想花费大量时间配置多个服务（PostgreSQL、Redis、MinIO）
- **低资源占用**：现有服务器配置无法支持原版的资源需求
- **运维简单**：团队规模小，没有专职运维，需要易于维护的方案
- **功能完整**：需要与原版 Happy Server 功能一致，确保团队成员的使用体验

**典型场景：**
- 小型技术创业公司需要内部部署 Claude Code 同步服务
- 远程团队需要在内网环境部署
- 对数据隐私有特殊要求的团队
- 预算有限但需要完整功能的自部署方案

### 次要用户

**使用 Claude Code 的团队成员**

虽然他们不直接部署和管理 Happy Server Go，但他们是最终受益者。简化的部署意味着团队能够更快地开始使用 Claude Code 的多设备同步功能，而不需要等待复杂的基础设施搭建。

---

## 成功指标

### 用户成功指标

**部署体验：**
- **部署时间**：从下载到运行成功 < 5 分钟
- **部署成功率**：首次部署成功率 > 90%
- **资源占用**：总内存占用 < 500MB

**运行稳定性：**
- **功能完整性**：100% API 兼容，现有客户端零改动切换
- **稳定运行**：在 1-2GB VPS 环境下稳定运行

### 业务目标

**采用和增长：**
- 成为小团队和低配置 VPS 用户的首选自部署方案
- 吸引原本因资源限制无法自部署的新用户群体

**社区认可：**
- 被社区定位为 "Happy Server 的自部署友好版本"
- 用户反馈："终于可以在 1GB VPS 上跑了"

---

## MVP 范围

### 核心功能

**功能完整性目标：**
实现 Happy Server (Node.js 版本) 的 100% 功能对等，确保现有客户端无需任何修改即可切换使用。

**核心功能清单：**
- 🔐 **零知识加密存储**：服务器存储加密数据但无法解密
- ⚡ **WebSocket 实时同步**：跨设备实时数据同步
- 📱 **多设备会话管理**：支持手机、平板、电脑无缝切换
- 🔔 **加密推送通知**：任务完成和权限请求通知（加密）
- 🔑 **加密签名认证**：基于公钥签名的认证系统
- 📝 **完整 API 兼容**：所有 RESTful API 端点与原版一致

**技术架构目标：**
- **内置依赖替代**：
  - BigCache + 事件总线 → 替代 Redis
  - SQLite → 替代 PostgreSQL
  - 本地文件存储 → 替代 MinIO
- **部署方式**：
  - 单二进制文件部署支持
  - Docker 容器部署支持
- **性能目标**：
  - 总内存占用 < 500MB
  - 适配 1-2GB RAM VPS 环境

### 明确不包含（Out of Scope）

**数据迁移：**
- ❌ 不支持从 Node.js 版本的数据迁移
- 用户如需迁移，需使用全新部署

**理由：**
MVP 聚焦于完整功能实现和部署体验优化，数据迁移工具可作为后续独立项目考虑。

### MVP 成功标准

**功能验证：**
- 所有原版 API 端点正常工作
- 现有客户端零改动即可连接使用
- 多设备同步功能稳定运行

**性能验证：**
- 内存占用 < 500MB（实际测试验证）
- 在 1GB RAM VPS 上稳定运行
- 部署时间 < 5 分钟（从下载到运行）

**部署验证：**
- 单二进制文件可以直接运行
- Docker 容器一键部署成功
- 首次部署成功率 > 90%

### 未来愿景

**Post-MVP 增强：**
- 数据迁移工具（从 Node.js 版本迁移）
- 性能监控和可观测性增强
- 集群部署支持（多实例负载均衡）
- 管理界面（Web UI）

**长期演进：**
- 作为 Happy Server 生态的标准自部署选项
- 支持更多嵌入式和边缘设备部署场景
- 社区驱动的功能增强和优化

---
